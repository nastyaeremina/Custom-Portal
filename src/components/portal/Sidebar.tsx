"use client";

import type { PreviewBranding, PreviewTheme } from "@/types/preview";
import { CompanyLogo } from "./CompanyLogo";

interface SidebarProps {
  branding: PreviewBranding;
  theme: PreviewTheme;
  activeItem?: string;
}

const MENU_ITEMS = [
  { id: "home", label: "Home" },
  { id: "messages", label: "Messages" },
  { id: "files", label: "Files" },
  { id: "forms", label: "Forms" },
  { id: "contracts", label: "Contracts" },
  { id: "billing", label: "Billing" },
  { id: "helpdesk", label: "Helpdesk" },
  { id: "store", label: "Store" },
];

/* ─── Figma icon components (fill="currentColor" inherits sidebarText) ─── */

function HomeIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 20 20" fill="none">
      <g clipPath="url(#clip_home)">
        <path
          d="M9.37496 0.238281C9.73043 -0.0820313 10.2695 -0.0820313 10.625 0.238281L19.6875 8.36328C20.0742 8.70703 20.1054 9.30078 19.7578 9.6875C19.4101 10.0742 18.8203 10.1055 18.4336 9.75781L18.1211 9.47656V17.4961C18.1211 18.875 17 19.9961 15.6211 19.9961H4.37105C2.99215 19.9961 1.87105 18.875 1.87105 17.4961V9.47656L1.55855 9.75781C1.17184 10.1016 0.581992 10.0703 0.234336 9.6875C-0.11332 9.30469 -0.0781639 8.71094 0.304649 8.36328L9.37496 0.238281ZM9.99996 2.19531L3.74996 7.80078V17.5C3.74996 17.8437 4.03121 18.125 4.37496 18.125H6.24996V14.0625C6.24996 12.5078 7.50777 11.25 9.06246 11.25H10.9375C12.4921 11.25 13.75 12.5078 13.75 14.0625V18.125H15.625C15.9687 18.125 16.25 17.8437 16.25 17.5V7.80078L9.99996 2.19922V2.19531ZM8.12496 18.125H11.875V14.0625C11.875 13.543 11.457 13.125 10.9375 13.125H9.06246C8.54293 13.125 8.12496 13.543 8.12496 14.0625V18.125Z"
          fill="currentColor"
        />
      </g>
      <defs>
        <clipPath id="clip_home">
          <rect width="20" height="20" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}

function MessagesIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        d="M2.37203 5.45566C2.76489 5.45566 3.08363 5.7744 3.08363 6.16727V6.40447L4.15846 5.59798C4.28151 5.50607 4.43124 5.45566 4.58542 5.45566H6.64167C6.77214 5.45566 6.87888 5.34892 6.87888 5.21846V0.948811C6.87888 0.818349 6.77214 0.711608 6.64167 0.711608H0.948811C0.818349 0.711608 0.711608 0.818349 0.711608 0.948811V5.21846C0.711608 5.34892 0.818349 5.45566 0.948811 5.45566H2.37203ZM3.08363 7.29398L3.08067 7.29695L3.00506 7.35328L2.75155 7.54304C2.68039 7.59642 2.58403 7.60531 2.50249 7.56528C2.42095 7.52525 2.37203 7.44372 2.37203 7.35328V7.03751V6.94263V6.93818V6.87888V6.16727H1.66042H0.948811C0.425482 6.16727 0 5.74179 0 5.21846L0 0.948811C0 0.425482 0.425482 0 0.948811 0L6.64167 0C7.165 0 7.59049 0.425482 7.59049 0.948811V5.21846C7.59049 5.74179 7.165 6.16727 6.64167 6.16727H4.58542L3.08363 7.29398Z"
        fill="currentColor"
      />
    </svg>
  );
}

function FilesIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        d="M0 1.42342C0 0.900092 0.425482 0.474609 0.948811 0.474609H2.90722C3.19038 0.474609 3.46168 0.587281 3.66182 0.78742L4.29782 1.42342H6.64167C7.165 1.42342 7.59049 1.8489 7.59049 2.37223V6.16747C7.59049 6.6908 7.165 7.11628 6.64167 7.11628H0.948811C0.425482 7.11628 0 6.6908 0 6.16747L0 1.42342ZM0.948811 1.18622C0.818349 1.18622 0.711608 1.29296 0.711608 1.42342V6.16747C0.711608 6.29793 0.818349 6.40468 0.948811 6.40468H6.64167C6.77214 6.40468 6.87888 6.29793 6.87888 6.16747V2.37223C6.87888 2.24177 6.77214 2.13503 6.64167 2.13503H4.24889C4.09175 2.13503 3.94053 2.07276 3.82934 1.96157L3.15924 1.28999C3.09253 1.22328 3.0021 1.18622 2.90722 1.18622H0.948811Z"
        fill="currentColor"
      />
    </svg>
  );
}

function FormsIcon() {
  return (
    <svg width="10" height="10" viewBox="0 0 11 11" fill="none">
      <g clipPath="url(#clip_forms)">
        <path
          d="M3.04016 1.42514C3.21608 1.22945 3.20027 0.93097 3.00458 0.755045C2.80889 0.579119 2.51041 0.594933 2.33448 0.790625L1.2473 1.99838L0.810454 1.56153C0.624645 1.3777 0.324189 1.3777 0.13838 1.56153C-0.0474287 1.74537-0.0474287 2.0478 0.13838 2.23163L0.929056 3.02231C1.02196 3.11521 1.14649 3.16463 1.27695 3.16068C1.40741 3.15672 1.52997 3.10137 1.61694 3.00452L3.04016 1.42317V1.42514ZM3.04016 4.58784C3.21608 4.39215 3.20027 4.09367 3.00458 3.91775C2.80889 3.74182 2.51041 3.75764 2.33448 3.95333L1.2473 5.16108L0.810454 4.72424C0.624645 4.53843 0.324189 4.53843 0.140357 4.72424C-0.0434754 4.91005-0.0454521 5.2105 0.140357 5.39433L0.931032 6.18501C1.02394 6.27791 1.14847 6.32733 1.27893 6.32338C1.40939 6.31942 1.53195 6.26408 1.61892 6.16722L3.04214 4.58587L3.04016 4.58784ZM4.26966 2.37198H9.64625C9.90915 2.37198 10.1207 2.16047 10.1207 1.89757C10.1207 1.63467 9.90915 1.42317 9.64625 1.42317L4.26966 1.42317C4.00676 1.42317 3.79525 1.63467 3.79525 1.89757C3.79525 2.16047 4.00676 2.37198 4.26966 2.37198ZM3.79525 5.06027C3.79525 5.32317 4.00676 5.53468 4.26966 5.53468H9.64625C9.90915 5.53468 10.1207 5.32317 10.1207 5.06027C10.1207 4.79737 9.90915 4.58587 9.64625 4.58587L4.26966 4.58587C4.00676 4.58587 3.79525 4.79737 3.79525 5.06027ZM3.16271 8.22298C3.16271 8.48588 3.37422 8.69738 3.63712 8.69738H9.64625C9.90915 8.69738 10.1207 8.48588 10.1207 8.22298C10.1207 7.96008 9.90915 7.74857 9.64625 7.74857H3.63712C3.37422 7.74857 3.16271 7.96008 3.16271 8.22298ZM1.89763 8.22298C1.89763 8.05522 1.83099 7.89433 1.71237 7.7757C1.59374 7.65708 1.43285 7.59044 1.26509 7.59044C1.09733 7.59044 0.936443 7.65708 0.817819 7.7757C0.699195 7.89433 0.632552 8.05522 0.632552 8.22298C0.632552 8.39074 0.699195 8.55162 0.817819 8.67025C0.936443 8.78887 1.09733 8.85552 1.26509 8.85552C1.43285 8.85552 1.59374 8.78887 1.71237 8.67025C1.83099 8.55162 1.89763 8.39074 1.89763 8.22298Z"
          fill="currentColor"
        />
      </g>
      <defs>
        <clipPath id="clip_forms">
          <rect width="10.1206" height="10.1206" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}

function ContractsIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M0.182898 1.31852C0.690888 0.981022 1.36286 0.783691 2.08713 0.783691C2.72156 0.783691 3.31588 0.935108 3.79499 1.19952C4.2741 0.935108 4.86841 0.783691 5.50285 0.783691C6.22751 0.783691 6.8991 0.981033 7.40708 1.31852C7.50607 1.38429 7.56556 1.49524 7.56556 1.61409V6.54791C7.56556 6.67867 7.49364 6.79884 7.37839 6.86064C7.26315 6.92244 7.12326 6.91584 7.01434 6.84347C6.63574 6.59194 6.10424 6.42722 5.50285 6.42722C4.90181 6.42722 4.36994 6.59195 3.99136 6.84347C3.87238 6.92252 3.7176 6.92252 3.59862 6.84347C3.22004 6.59195 2.68816 6.42722 2.08713 6.42722C1.48609 6.42722 0.954219 6.59195 0.57564 6.84347C0.46672 6.91584 0.326827 6.92244 0.211581 6.86064C0.0963344 6.79884 0.0244141 6.67867 0.0244141 6.54791L0.0244141 1.61409C0.0244141 1.49524 0.0839085 1.38429 0.182898 1.31852ZM0.734124 1.81437V5.96655C1.13914 5.80627 1.60137 5.71751 2.08713 5.71751C2.72156 5.71751 3.31588 5.86892 3.79499 6.13334C4.2741 5.86892 4.86841 5.71751 5.50285 5.71751C5.98883 5.71751 6.45095 5.80626 6.85585 5.96652V1.81436C6.49355 1.61734 6.02449 1.4934 5.50285 1.4934C4.90181 1.4934 4.36994 1.65814 3.99136 1.90966C3.87238 1.98871 3.7176 1.98871 3.59862 1.90966C3.22004 1.65814 2.68816 1.4934 2.08713 1.4934C1.56579 1.4934 1.09648 1.61735 0.734124 1.81437Z"
        fill="currentColor"
      />
      <path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M3.79573 1.45879C3.99171 1.45879 4.15058 1.61767 4.15058 1.81365L4.15058 6.11559C4.15058 6.31157 3.99171 6.47044 3.79573 6.47044C3.59975 6.47044 3.44087 6.31157 3.44087 6.11559L3.44087 1.81365C3.44087 1.61767 3.59975 1.45879 3.79573 1.45879Z"
        fill="currentColor"
      />
    </svg>
  );
}

function BillingIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <g clipPath="url(#clip_billing)">
        <path
          d="M6.7471 1.4758C6.86306 1.4758 6.95795 1.57068 6.95795 1.68665V2.10834H0.63254V1.68665C0.63254 1.57068 0.727422 1.4758 0.843387 1.4758H6.7471ZM6.95795 2.84633V5.90359C6.95795 6.01955 6.86306 6.11443 6.7471 6.11443H0.843387C0.727422 6.11443 0.63254 6.01955 0.63254 5.90359V2.84633L3.79524 2.84633L6.95795 2.84633ZM0.843387 0.843262C0.378207 0.843262 0 1.22147 0 1.68665L0 5.90359C0 6.36877 0.378207 6.74697 0.843387 6.74697H6.7471C7.21228 6.74697 7.59049 6.36877 7.59049 5.90359V1.68665C7.59049 1.22147 7.21228 0.843262 6.7471 0.843262H0.843387ZM1.58135 4.84935C1.40608 4.84935 1.26508 4.99036 1.26508 5.16562C1.26508 5.34089 1.40608 5.48189 1.58135 5.48189H2.21389C2.38916 5.48189 2.53016 5.34089 2.53016 5.16562C2.53016 4.99036 2.38916 4.84935 2.21389 4.84935H1.58135Z"
          fill="currentColor"
        />
      </g>
      <defs>
        <clipPath id="clip_billing">
          <rect width="7.59049" height="7.59049" fill="white" />
        </clipPath>
      </defs>
    </svg>
  );
}

function HelpdeskIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        d="M2.08738 2.27724C2.08738 1.96295 2.34238 1.70796 2.65667 1.70796C2.97096 1.70796 3.22596 1.96295 3.22596 2.27724V2.37094C3.22596 2.69709 3.19868 3.02325 3.14294 3.34466L1.8739 3.73723C1.43626 3.87243 1.13857 4.27686 1.13857 4.73466V5.12368H0.284643C0.126903 5.12368 0 5.25058 0 5.40832C0 5.56606 0.126903 5.69296 0.284643 5.69296H1.14213C1.17771 6.11756 1.5347 6.45201 1.96878 6.45201C2.26054 6.45201 2.53095 6.29902 2.68039 6.04877L2.86897 5.73566C3.22003 5.14977 3.47502 4.51051 3.62327 3.84397L3.63513 3.78823L4.94923 3.38142L4.66578 4.17368C4.63494 4.26144 4.64799 4.35751 4.70136 4.43342C4.75473 4.50932 4.84131 4.55439 4.93382 4.55439H6.54679C6.70453 4.55439 6.83144 4.42749 6.83144 4.26975C6.83144 4.11201 6.70453 3.9851 6.54679 3.9851H5.33825L5.67626 3.03748C5.71303 2.93548 5.68812 2.82281 5.6134 2.74453C5.53868 2.66626 5.4272 2.63779 5.32401 2.66982L3.74662 3.15845C3.77864 2.89753 3.79524 2.63423 3.79524 2.37094V2.27724C3.79524 1.64866 3.28526 1.13867 2.65667 1.13867C2.02808 1.13867 1.5181 1.64866 1.5181 2.27724V2.75165C1.5181 2.90939 1.645 3.03629 1.80274 3.03629C1.96048 3.03629 2.08738 2.90939 2.08738 2.75165V2.27724ZM2.04231 4.28161L3.0018 3.9851C2.86304 4.49746 2.65311 4.98729 2.38033 5.4439L2.19175 5.75701C2.14431 5.83528 2.06011 5.88391 1.96878 5.88391C1.82527 5.88391 1.70786 5.76768 1.70786 5.62299V4.73585C1.70786 4.5283 1.84306 4.34447 2.04231 4.28279V4.28161ZM3.54499 5.69296H7.30584C7.46358 5.69296 7.59049 5.56606 7.59049 5.40832C7.59049 5.25058 7.46358 5.12368 7.30584 5.12368H3.81303C3.73238 5.317 3.64343 5.50676 3.54499 5.69296Z"
        fill="currentColor"
      />
    </svg>
  );
}

function StoreIcon() {
  return (
    <svg width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        d="M6.683 2.12842C6.75943 2.24965 6.76734 2.39856 6.71331 2.52507C6.66192 2.64631 6.56703 2.72011 6.44843 2.73592C6.42208 2.73987 6.39704 2.74119 6.372 2.74119C6.21782 2.74119 6.07945 2.67398 5.98062 2.56724C5.8607 2.43546 5.6907 2.36035 5.51148 2.36035C5.33226 2.36035 5.16227 2.43678 5.04367 2.56856C4.94747 2.6753 4.81042 2.74251 4.6536 2.74251C4.4981 2.74251 4.35973 2.6753 4.26353 2.56856C4.14361 2.43546 3.97362 2.36035 3.7944 2.36035C3.61518 2.36035 3.44518 2.43546 3.32526 2.56856C3.22907 2.6753 3.09201 2.74251 2.9352 2.74251C2.7797 2.74251 2.64133 2.6753 2.54513 2.56856C2.42521 2.43546 2.25522 2.36035 2.076 2.36035C1.89678 2.36035 1.72678 2.43546 1.60686 2.56856C1.51066 2.6753 1.37361 2.74251 1.2168 2.74251C1.19308 2.74251 1.16672 2.74119 1.14036 2.73724C1.02308 2.72142 0.929517 2.64763 0.878123 2.52639C0.824094 2.39988 0.832001 2.25097 0.908433 2.12973L1.5871 1.05442H6.00434L6.683 2.12842ZM6.372 3.37373C6.42603 3.37373 6.47874 3.36978 6.53014 3.36319C7.26151 3.26567 7.60809 2.40779 7.21671 1.78974L6.46161 0.594506C6.3944 0.487765 6.27448 0.421875 6.14666 0.421875H1.44477C1.31695 0.421875 1.19703 0.487765 1.12982 0.594506L0.373409 1.78974C-0.016658 2.40647 0.328604 3.26435 1.05734 3.36319C1.11005 3.36978 1.16408 3.37373 1.2168 3.37373C1.47508 3.37373 1.71097 3.28939 1.90073 3.14971C1.96398 3.10358 2.02197 3.04955 2.07468 2.99289C2.12739 3.05087 2.18537 3.10358 2.24863 3.14971C2.43971 3.28939 2.67559 3.37373 2.93388 3.37373C3.19217 3.37373 3.42805 3.28939 3.61913 3.14971C3.68239 3.10358 3.74037 3.04955 3.79308 2.99157C3.84579 3.04955 3.90378 3.10227 3.96703 3.14839C4.15811 3.28807 4.39399 3.37241 4.65228 3.37241C4.9132 3.37241 5.15041 3.28676 5.34149 3.14443C5.40342 3.09831 5.46009 3.04692 5.51148 2.99025C5.56288 3.04692 5.62086 3.09963 5.6828 3.14575C5.87388 3.28676 6.11108 3.37241 6.37068 3.37241L6.372 3.37373ZM1.4764 4.84966V3.77434C1.39206 3.78884 1.30641 3.79542 1.21811 3.79542C1.14564 3.79542 1.07316 3.79015 1.00331 3.78093H1.002C0.947966 3.77302 0.895255 3.7638 0.843861 3.75062V4.84966V5.4822V6.32559C0.843861 6.79077 1.22207 7.16897 1.68725 7.16897H5.90418C6.36937 7.16897 6.74757 6.79077 6.74757 6.32559V5.4822V4.84966V3.75062C6.69486 3.7638 6.64215 3.77434 6.58548 3.78093C6.58548 3.78093 6.58548 3.78093 6.58417 3.78093C6.51432 3.79015 6.44316 3.79542 6.37068 3.79542C6.28371 3.79542 6.19805 3.78884 6.11503 3.77434V4.84966H1.4764ZM6.11503 5.4822V6.32559C6.11503 6.44155 6.02015 6.53643 5.90418 6.53643H1.68725C1.57128 6.53643 1.4764 6.44155 1.4764 6.32559V5.4822H6.11503Z"
        fill="currentColor"
      />
    </svg>
  );
}

const iconComponents: Record<string, React.FC> = {
  home: HomeIcon,
  messages: MessagesIcon,
  files: FilesIcon,
  forms: FormsIcon,
  contracts: HelpdeskIcon,
  billing: BillingIcon,
  helpdesk: ContractsIcon,
  store: StoreIcon,
};

export function Sidebar({
  branding,
  theme,
  activeItem = "home",
}: SidebarProps) {
  const { companyName, logoUrl } = branding;
  const { sidebarBackground, sidebarText } = theme;

  return (
    <div
      className="w-[155px] flex flex-col py-4 px-2.5 shrink-0"
      style={{
        backgroundColor: sidebarBackground,
        color: sidebarText,
        fontFamily: "var(--font-portal)",
      }}
    >
      {/* Logo / Company name */}
      <div className="flex items-center gap-2 mb-5 px-1.5">
        <CompanyLogo logoUrl={logoUrl} companyName={companyName} variant="sidebar" squareIconBg={branding.squareIconBg} logoDominantColor={branding.logoDominantColor} squareIconFg={branding.squareIconFg} accentColor={theme.accent} sidebarBackground={sidebarBackground} />
        <span className="font-medium text-[11px] truncate">{companyName}</span>
      </div>

      {/* Nav items */}
      <nav className="flex-1 flex flex-col gap-0.5">
        {MENU_ITEMS.map((item) => {
          const isActive = item.id === activeItem.toLowerCase();
          const IconComponent = iconComponents[item.id];

          return (
            <div
              key={item.id}
              className="flex items-center gap-[6px] px-[6px] py-[3px] rounded-[3px] text-[10px] font-medium cursor-default"
              style={{
                color: sidebarText,
                backgroundColor: isActive
                  ? (sidebarText === "#ffffff" ? "rgba(255,255,255,0.15)" : "rgba(0,0,0,0.08)")
                  : undefined,
              }}
            >
              <span className="w-2 h-2 flex items-center justify-center shrink-0">
                {IconComponent && <IconComponent />}
              </span>
              <span className="flex-1 text-left truncate">{item.label}</span>
            </div>
          );
        })}
      </nav>
    </div>
  );
}
